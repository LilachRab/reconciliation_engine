# Insurance Reconciliation System

A comprehensive Python application for generating synthetic healthcare claims and invoices data, performing automated reconciliation analysis, and generating interactive HTML reports with visualizations.

## Project Overview

This system simulates a real-world insurance claims reconciliation process by:

1. **Data Generation**: Creates synthetic patient data, healthcare claims, and corresponding invoices with configurable payment status distributions
2. **Data Validation**: Uses robust data loaders with strict validation rules to ensure data integrity
3. **Reconciliation Analysis**: Compares claims benefit amounts with invoice transaction totals to identify discrepancies
4. **Interactive Reporting**: Generates comprehensive HTML reports with summary statistics, pie charts, and filterable data tables

### Key Features

-   **Synthetic Data Generation**: Generates realistic healthcare claims and invoice data with configurable parameters
-   **Advanced Reconciliation Logic**: Automatically categorizes claims as Balanced, Overpaid, or Underpaid
-   **Interactive Visualizations**: Pie charts showing status distribution and financial impact analysis
-   **Responsive Web Reports**: Professional HTML reports with pagination, filtering, and mobile-responsive design
-   **Robust Data Processing**: Uses Polars for high-performance data manipulation and validation
-   **Modular Architecture**: Clean separation between data generation, processing, and reporting components

## Installation

### Prerequisites

-   Python 3.8 or higher
-   Windows PowerShell (for the setup commands below)

### Setup Instructions

```powershell
# From the project root directory
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# Install required packages
pip install polars pyarrow matplotlib python-dateutil
```

### Required Dependencies

-   **polars**: High-performance DataFrame library for data processing
-   **pyarrow**: Apache Arrow integration for Polars
-   **matplotlib**: Chart generation for pie charts in reports
-   **python-dateutil**: Date parsing and manipulation utilities

## Usage

The system provides two main scripts that can be run through the main entry point:

### Complete Workflow (Recommended)

Run the entire workflow from data generation to report creation:

```powershell
# Navigate to the project directory
cd reconciliation_engine

# Run the complete workflow
python src/main.py
```

This will:

1. Generate 200 synthetic patients with associated claims and invoices
2. Perform reconciliation analysis
3. Create a comprehensive HTML report

### Configuration

You can modify the number of patients generated by editing `main.py`:

```python
NUM_OF_PATIENTS = 200  # Change this value as needed
```

## Project Structure

```
insurance-reconciliation/
├── src/                                        # Source code
│   ├── __init__.py                             # Package initialization
│   ├── constants/                              # Business constants and enums
│   │   ├── __init__.py                         # Package exports
│   │   └── constants.py                        # Business domain constants
│   ├── data/                                   # Data loading and generation
│   │   ├── __init__.py                         # Package exports
│   │   ├── generator.py                        # Synthetic data generators
│   │   └── loader.py                           # CSV data loaders with validation
│   ├── models/                                 # Data schemas and type definitions
│   │   ├── __init__.py                         # Package exports
│   │   ├── schemas.py                          # Polars schema definitions
│   │   └── types.py                            # TypedDict definitions
│   ├── processing/                             # Reconciliation logic
│   │   ├── __init__.py                         # Package exports
│   │   └── reconciliation.py                   # Core reconciliation algorithms
│   ├── reporting/                              # Report generation
│   │   ├── __init__.py                         # Package exports
│   │   └── report_generator.py                 # Interactive HTML report with charts
│   ├── strategies/                             # Payment status generation strategies
│   │   ├── __init__.py                         # Package exports
│   │   └── invoice_reconciliation_strategy.py  # Weighted payment status strategies
│   ├── generate_input_data.py                  # Data generation script
│   ├── main.py                                 # Main entry point
│   ├── reconciliation_engine.py                # High-level workflow orchestration
│   └── utils.py                                # Utility functions
├── input/                                      # Generated CSV data files
│   ├── claims.csv                              # Healthcare claims data
│   └── invoices.csv                            # Invoice transaction data
├── output/                                     # Generated reports
│   └── report.html                             # Interactive HTML report
├── .gitignore                                  # Git ignore rules
└── README.md                                   # This file
```

## Output Explanation

### Generated Data Files

#### `input/claims.csv`

Contains synthetic healthcare claims with the following fields:

-   **claim_id**: Unique claim identifier
-   **patient_id**: Associated patient identifier
-   **date_of_service**: When the service was provided
-   **charges_amount**: Total charges for the claim
-   **benefit_amount**: Amount covered by insurance

#### `input/invoices.csv`

Contains invoice transactions related to claims:

-   **invoice_id**: Unique invoice identifier
-   **claim_id**: Related claim identifier
-   **type_of_bill**: Type of billing ("fee" or "procedure payment")
-   **transaction_value**: Amount of the invoice transaction
-   **date_of_transaction**: When the transaction occurred

### Reconciliation Report

The system generates `output/report.html`, a comprehensive interactive report containing:

#### 1. Header Section

-   Project title and description

#### 2. Summary Cards

A row of 5 informational cards displaying:

-   **Total Claims**: Total number of claims processed
-   **Balanced Claims**: Claims where benefit amount equals transaction total
-   **Overpaid Claims**: Claims where transactions exceed benefit amount (with total overpaid amount)
-   **Underpaid Claims**: Claims where transactions are less than benefit amount (with total underpaid amount)
-   **Total Issues**: Combined count and percentage of overpaid and underpaid claims

#### 3. Status Distribution Chart

-   Interactive pie chart showing the percentage breakdown of claim statuses
-   Color-coded: Green (Balanced), Red (Overpaid), Yellow (Underpaid)

#### 4. Detailed Data Table

-   **Filterable**: Click buttons to show All, Balanced, Overpaid, or Underpaid claims
-   **Paginated**: 20 records per page with navigation controls

### Reconciliation Logic

The system categorizes each claim based on comparing the benefit amount with the sum of related invoice transactions:

-   **BALANCED**: `benefit_amount == total_transaction_value`
-   **OVERPAID**: `total_transaction_value > benefit_amount`
-   **UNDERPAID**: `total_transaction_value < benefit_amount`

## Troubleshooting

### Common Issues

**Import Error**: "Import 'polars' could not be resolved"

```powershell
# Ensure virtual environment is activated
.\.venv\Scripts\Activate.ps1

# Reinstall dependencies
pip install polars pyarrow matplotlib python-dateutil
```

**Module Not Found**: "No module named 'src'"

```powershell
# Ensure you're in the correct directory
cd insurance-reconciliation
python src/main.py
```

**Permission Error**: Cannot write to output directory

```powershell
# Check directory permissions or run as administrator
# The script automatically creates the output directory if it doesn't exist
```

## Customization

### Modifying Payment Status Distribution

Edit `src/strategies/invoice_reconciliation_strategy.py` to adjust the likelihood of different payment statuses:

```python
class BalancedStrategy(PaymentStatusStrategy):
    weight = 0.55  # 55% of claims will be balanced

class UnderpaidStrategy(PaymentStatusStrategy):
    weight = 0.225  # 22.5% of claims will be underpaid

class OverpaidStrategy(PaymentStatusStrategy):
    weight = 0.225  # 22.5% of claims will be overpaid
```

## License

This project is part of the Bluespine company technical assignment and is intended for evaluation purposes.
